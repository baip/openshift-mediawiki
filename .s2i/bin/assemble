#!/bin/bash

set -e

source ${PHP_CONTAINER_SCRIPTS_PATH}/common.sh

shopt -s dotglob
echo "---> Installing application source..."
mv /tmp/src/* ./

version=1.29.0
libs/install-mediawiki ${version}
cp -al mediawiki-${version}/* php/
rm -rf mediawiki-${version}

cp -r .openshift/action_hooks/LocalSettings.php php/
source libs/generate-secret
sed -i "s/MEDIAWIKI_UPGRADE_KEY/${upgrade_key}/;s/MEDIAWIKI_SECRET_KEY/${secret_key}/" php/LocalSettings.php

# post-assemble files
process_extending_files ./php-post-assemble/ ${PHP_CONTAINER_SCRIPTS_PATH}/post-assemble/

# Fix source directory permissions
fix-permissions ./
fix-permissions ${HTTPD_CONFIGURATION_PATH}
